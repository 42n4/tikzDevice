language: python

env:
  matrix:
    - TYPE=cran
    - TYPE=tests DISPLAY=:99.0

install:
  - sudo apt-get install --no-install-recommends texinfo texlive-latex-recommended texlive-latex-extra lmodern texlive-fonts-recommended texlive-fonts-extra pgf texlive-xetex imagemagick
  - "[ $TYPE = tests ] && (cd /tmp && curl -OL http://mirrors.ctan.org/install/macros/latex/contrib/oberdiek.tds.zip && cd /usr/share/texmf/tex/latex && sudo unzip /tmp/oberdiek.tds.zip && sudo texhash --quiet)"

script:
  - sh -e /etc/init.d/xvfb start
  - "[ $TYPE = cran ] && (curl https://raw.githubusercontent.com/yihui/r-shippable/master/r-cmd-check | bash)"
  - "[ $TYPE = tests ] && (cd ..; R CMD build code; R CMD INSTALL *_*.tar.gz; cd code/tests; ./unit_tests.R)"
  - sh -e /etc/init.d/xvfb stop

after_failure:
  - cd ..; for i in `ls *.Rcheck/00*`; do cat $i; done
